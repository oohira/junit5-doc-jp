[[running-tests]]
== ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹

[[running-tests-ide]]
=== IDEã®ã‚µãƒãƒ¼ãƒˆ

[[running-tests-ide-intellij-idea]]
==== IntelliJ IDEA

IntelliJ IDEAã¯ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³2016.2ã‹ã‚‰JUnit Platformä¸Šã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
è©³ç´°ã¯ã€
https://blog.jetbrains.com/idea/2016/08/using-junit-5-in-intellij-idea/[IntelliJ IDEAãƒ–ãƒ­ã‚°ã®æŠ•ç¨¿]
ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ãŸã ã—ã€å®Ÿéš›ã«ã¯IntelliJ IDEA 2017.3ã¾ãŸã¯ãã‚Œã‚ˆã‚Šæ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®
åˆ©ç”¨ãŒæ¨å¥¨ã•ã‚Œã‚‹ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã¨ã„ã†ã®ã‚‚ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§åˆ©ç”¨ã•ã‚Œã‚‹APIãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«å¿œã˜ã¦
`junit-platform-launcher`, `junit-jupiter-engine`, `junit-vintage-engine`
ã®JARã‚’è‡ªå‹•çš„ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚

WARNING: IntelliJ IDEAã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³2017.3ã‚ˆã‚Šå‰ã®ãƒªãƒªãƒ¼ã‚¹ã¯ã€JUnit 5
ã®ç‰¹å®šã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åŒæ¢±ã—ã¦ã„ã‚‹ç‚¹ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã‚‚ã—ã‚‚JUnit Jupiter
ã®æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã„ãŸã„å ´åˆã€IDEå†…ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã§
å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ãã®ã‚ˆã†ãªå ´åˆã¯ã€IntelliJ IDEAã«åŒæ¢±ã•ã‚Œã¦ã„ã‚‹
JUnit 5ã‚ˆã‚Šæ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã†ãŸã‚ã«ã€ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„ã€‚

JUnit 5ã®ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ (ä¾‹ãˆã°ã€ {jupiter-version}) ã‚’ä½¿ã†ã«ã¯ã€
`junit-platform-launcher`, `junit-jupiter-engine`, `junit-vintage-engine`
ã®å¯¾å¿œã™ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®JARã‚’ã‚¯ãƒ©ã‚¹ãƒ‘ã‚¹ã«è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

.Gradleã®è¿½åŠ ã®ä¾å­˜é–¢ä¿‚
[source,groovy]
[subs=attributes+]
----
// Only needed to run tests in a version of IntelliJ IDEA that bundles older versions
testRuntime("org.junit.platform:junit-platform-launcher:{platform-version}")
testRuntime("org.junit.jupiter:junit-jupiter-engine:{jupiter-version}")
testRuntime("org.junit.vintage:junit-vintage-engine:{vintage-version}")
----

.Mavenã®è¿½åŠ ã®ä¾å­˜é–¢ä¿‚
[source,xml]
[subs=attributes+]
----
<!-- Only needed to run tests in a version of IntelliJ IDEA that bundles older versions -->
<dependency>
	<groupId>org.junit.platform</groupId>
	<artifactId>junit-platform-launcher</artifactId>
	<version>{platform-version}</version>
	<scope>test</scope>
</dependency>
<dependency>
	<groupId>org.junit.jupiter</groupId>
	<artifactId>junit-jupiter-engine</artifactId>
	<version>{jupiter-version}</version>
	<scope>test</scope>
</dependency>
<dependency>
	<groupId>org.junit.vintage</groupId>
	<artifactId>junit-vintage-engine</artifactId>
	<version>{vintage-version}</version>
	<scope>test</scope>
</dependency>
----

[[running-tests-ide-eclipse]]
==== Eclipse

Eclipse IDEã¯ã€Oxygen.1a (4.7.1a)ãƒªãƒªãƒ¼ã‚¹ã‹ã‚‰JUnit Platformã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

Eclipseã§JUnit 5ã‚’ä½¿ã†ãŸã‚ã®æƒ…å ±ã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
https://www.eclipse.org/eclipse/news/4.7.1a/#junit-5-support[Eclipse Project Oxygen.1a
(4.7.1a) - New and Noteworthy] ã® _Eclipse support for JUnit 5_ ã®ç¯€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[[running-tests-ide-other]]
==== ãã®ä»–ã®IDE

æœ¬æ›¸åŸ·ç­†æ™‚ç‚¹ã§ã¯ã€IntelliJ IDEAã¨Eclipseä»¥å¤–ã®IDEã¯ã€JUnit Platform
ä¸Šã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’ç›´æ¥ã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚ã—ã‹ã—ã€JUnitãƒãƒ¼ãƒ ã¯
ã‚ãªãŸãŒä½¿ã£ã¦ã„ã‚‹IDEã§JUnit 5ã‚’è©¦ã›ã‚‹ã‚ˆã†ã«ã€2ã¤ã®ä¸­é–“è§£ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚
<<running-tests-console-launcher>> ã‚’æ‰‹å‹•ã§ä½¿ã†ã‹ã€
<<running-tests-junit-platform-runner,JUnit 4ãƒ™ãƒ¼ã‚¹ã®ãƒ©ãƒ³ãƒŠãƒ¼>>
ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

[[running-tests-build]]
=== ãƒ“ãƒ«ãƒ‰ã‚µãƒãƒ¼ãƒˆ

[[running-tests-build-gradle]]
==== Gradle

JUnitãƒãƒ¼ãƒ ã¯ã€`TestEngine` ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã‚ã‚‰ã‚†ã‚‹ç¨®é¡ã®ãƒ†ã‚¹ãƒˆï¼ˆä¾‹ãˆã°ã€
JUnit 3ã€JUnit 4ã€JUnit Jupiterã€ {Specsy} ãªã©ï¼‰ã‚’å®Ÿè¡Œã§ãã‚‹Gradle
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’é–‹ç™ºã—ã¾ã—ãŸã€‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä½¿ç”¨ä¾‹ã¯ã€`{junit5-gradle-consumer}`
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `build.gradle` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[[running-tests-build-gradle-junit-enable]]
===== JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æœ‰åŠ¹ã«ã™ã‚‹

JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã†ã«ã¯ã€ã¾ãšGradle 2.5ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ã‚’
ç¢ºèªã—ã¦ãã ã•ã„ã€‚ãã®å¾Œã€`build.gradle` ã‚’æ¬¡ã®ã‚ˆã†ã«è¨­å®šã§ãã¾ã™ã€‚

[source,java,indent=0]
[subs=attributes+]
----
buildscript {
	repositories {
		mavenCentral()
		// The following is only necessary if you want to use SNAPSHOT releases.
		// maven { url 'https://oss.sonatype.org/content/repositories/snapshots' }
	}
	dependencies {
		classpath 'org.junit.platform:junit-platform-gradle-plugin:{platform-version}'
	}
}

apply plugin: 'org.junit.platform.gradle.plugin'
----

[[running-tests-build-gradle-junit-configure]]
===== JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¨­å®šã™ã‚‹

JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’é©ç”¨å¾Œã€æ¬¡ã®ã‚ˆã†ã«è¨­å®šã‚’å¤‰æ›´ã§ãã¾ã™ã€‚

[source,java,indent=0]
[subs=attributes+]
----
junitPlatform {
	platformVersion '{platform-version}' // optional, defaults to plugin version
	reportsDir file('build/test-results/junit-platform') // this is the default
	// enableStandardTestTask true
	// selectors (optional)
	// filters (optional)
	// logManager (optional)
}
----

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯Gradleæ¨™æº–ã® `test` ã‚¿ã‚¹ã‚¯ã‚’ç„¡åŠ¹åŒ–ã—ã¾ã™ãŒã€
`enableStandardTestTask` ãƒ•ãƒ©ã‚°ã§å¤‰æ›´ã§ãã¾ã™ã€‚

[[running-tests-build-gradle-selectors]]
===== ã‚»ãƒ¬ã‚¯ã‚¿ã‚’è¨­å®šã™ã‚‹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€ãƒ†ã‚¹ãƒˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰æ¢ã•ã‚Œã¾ã™ã€‚
ã—ã‹ã—ã€`selectors` æ‹¡å¼µè¦ç´ ã‚’ä½¿ãˆã°ã€å®Ÿè¡Œã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

[source,java,indent=0]
----
junitPlatform {
	// ...
	selectors {
		uris 'file:///foo.txt', 'http://example.com/'
		uri 'foo:resource' <1>
		files 'foo.txt', 'bar.csv'
		file 'qux.json' <2>
		directories 'foo/bar', 'bar/qux'
		directory 'qux/bar' <3>
		packages 'com.acme.foo', 'com.acme.bar'
		aPackage 'com.example.app' <4>
		classes 'com.acme.Foo', 'com.acme.Bar'
		aClass 'com.example.app.Application' <5>
		methods 'com.acme.Foo#a', 'com.acme.Foo#b'
		method 'com.example.app.Application#run(java.lang.String[])' <6>
		resources '/bar.csv', '/foo/input.json'
		resource '/com/acme/my.properties' <7>
		modules 'foo', 'bar'
		module 'baz' <8>
	}
	// ...
}
----
<1> URIï¼ˆè¨³æ³¨ï¼šURIã‹ã‚‰ã©ã†ãƒ†ã‚¹ãƒˆã‚’è§£æ±ºã™ã‚‹ã‹ã¯å€‹ã€…ã®ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã«ä¾å­˜ã—ã¦ãŠã‚Šã€JUnit PlatformãŒé–¢çŸ¥ã™ã‚‹ã¨ã“ã‚ã§ã¯ãªã„ï¼‰
<2> ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«
<3> ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
<4> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
<5> ã‚¯ãƒ©ã‚¹ã®å®Œå…¨ä¿®é£¾å
<6> ãƒ¡ã‚½ãƒƒãƒ‰ã®å®Œå…¨ä¿®é£¾å ({DiscoverySelectors_selectMethod} ã‚’å‚ç…§)
<7> ã‚¯ãƒ©ã‚¹ãƒ‘ã‚¹ãƒªã‚½ãƒ¼ã‚¹
<8> ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å

[[running-tests-build-gradle-filters]]
===== ãƒ•ã‚£ãƒ«ã‚¿ã‚’è¨­å®šã™ã‚‹

`filters` æ‹¡å¼µã‚’ä½¿ã†ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆãƒ—ãƒ©ãƒ³ã®ãƒ•ã‚£ãƒ«ã‚¿ã‚’è¨­å®šã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€
ã™ã¹ã¦ã®ã‚¨ãƒ³ã‚¸ãƒ³ã¨ã‚¿ã‚°ãŒãƒ†ã‚¹ãƒˆãƒ—ãƒ©ãƒ³ã«å«ã¾ã‚Œã€`includeClassNamePattern`
(`{standard-include-class-name-pattern}`) ã ã‘ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚
æ¬¡ã®ä¾‹ã§ç¤ºã™ã‚ˆã†ã«ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã¯å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
è¤‡æ•°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ãŸå ´åˆã¯ã€OR (è«–ç†å’Œ) ã§çµåˆã•ã‚Œã¾ã™ã€‚

[source,java,indent=0]
----
junitPlatform {
	// ...
	filters {
		engines {
			include 'junit-jupiter'
			// exclude 'junit-vintage'
		}
		tags {
			include 'fast', 'smoke & feature-a'
			// exclude 'slow', 'ci'
		}
		packages {
			include 'com.sample.included1', 'com.sample.included2'
			// exclude 'com.sample.excluded1', 'com.sample.excluded2'
		}
		includeClassNamePattern '.*Spec'
		includeClassNamePatterns '.*Test', '.*Tests'
	}
	// ...
}
----

`engines {include ...}` ã¾ãŸã¯ `engines {exclude ...}` ã§ _ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ID_
ã‚’æŒ‡å®šã™ã‚‹ã¨ã€JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ãã®ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒ†ã‚¹ãƒˆã ã‘ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
åŒæ§˜ã«ã€`tags {include ...}` ã¾ãŸã¯ `tags {exclude ...}` ã§ _ã‚¿ã‚°_ ã‚„
<<running-tests-tag-expressions, _ã‚¿ã‚°å¼_>> ã‚’æŒ‡å®šã™ã‚‹ã¨ã€JUnit Gradle
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ï¼ˆä¾‹ãˆã°ã€JUnit Jupiterãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆã®å ´åˆã¯ `@Tag` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ï¼‰
ã‚¿ã‚°ä»˜ã‘ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã ã‘ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
`packages {include ...}` ã¾ãŸã¯ `packages {exclude ...}` ã‚’ä½¿ã£ã¦ã€
ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã«ã¤ã„ã¦ã‚‚åŒæ§˜ã®ã“ã¨ãŒã§ãã¾ã™ã€‚

[[running-tests-build-gradle-config-params]]
===== è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼

`configurationParameter` ã¾ãŸã¯ `configurationParameters` DSL ã‚’ä½¿ã£ã¦ã€
ãƒ†ã‚¹ãƒˆã‚’ç™ºè¦‹ãƒ»å®Ÿè¡Œã™ã‚‹ãŸã‚ã®è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æŒ‡å®šã§ãã¾ã™ã€‚å‰è€…ã¯ã€
å˜ä¸€ã®è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’æŒ‡å®šã™ã‚‹ã®ã«ä½¿ãˆã¾ã™ã€‚å¾Œè€…ã¯ã€
ä¸€åº¦ã«è¤‡æ•°ã®ã‚­ãƒ¼ãƒ»å€¤ã®ãƒšã‚¢ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã«ã€è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã®ãƒãƒƒãƒ—ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚
ã™ã¹ã¦ã®ã‚­ãƒ¼ã¨å€¤ã¯ã€`String` ã§ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

[source,java,indent=0]
----
junitPlatform {
	// ...
	configurationParameter 'junit.jupiter.conditions.deactivate', '*'
	configurationParameters([
		'junit.jupiter.extensions.autodetection.enabled': 'true',
		'junit.jupiter.testinstance.lifecycle.default': 'per_class'
	])
	// ...
}
----

[[running-tests-build-gradle-engines-configure]]
===== ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã‚’è¨­å®šã™ã‚‹

JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã•ã›ã‚‹ãŸã‚ã«ã¯ã€`TestEngine`
ã®å®Ÿè£…ãŒã‚¯ãƒ©ã‚¹ãƒ‘ã‚¹ã«å­˜åœ¨ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

JUnit Jupiterãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«ã¯ã€JUnit Jupiter API
ã«å¯¾ã™ã‚‹ `testCompile` ä¾å­˜ã¨ã€JUnit Jupiter `TestEngine`
å®Ÿè£…ã«å¯¾ã™ã‚‹ `testRuntime` ä¾å­˜ã‚’æ¬¡ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

[source,java,indent=0]
[subs=attributes+]
----
dependencies {
	testCompile("org.junit.jupiter:junit-jupiter-api:{jupiter-version}")
	testRuntime("org.junit.jupiter:junit-jupiter-engine:{jupiter-version}")
}
----

JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€JUnit 4ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆã‚‚å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ãã®ãŸã‚ã«ã¯ã€JUnit 4ã«å¯¾ã™ã‚‹ `testCompile` ä¾å­˜ã¨ã€JUnit Vintage
`TestEngine` å®Ÿè£…ã«å¯¾ã™ã‚‹ `testRuntime` ä¾å­˜ãŒå¿…è¦ã§ã™ã€‚

[source,java,indent=0]
[subs=attributes+]
----
dependencies {
	testCompile("junit:junit:{junit4-version}")
	testRuntime("org.junit.vintage:junit-vintage-engine:{vintage-version}")
}
----

[[running-tests-build-gradle-logging]]
===== ãƒ­ã‚®ãƒ³ã‚°ã‚’è¨­å®šã™ã‚‹ï¼ˆçœç•¥å¯ï¼‰

JUnitã¯ã€`java.util.logging` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆåˆ¥åã€_JUL_ï¼‰ã® Java Logging API
ã‚’è­¦å‘Šã‚„ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã®å‡ºåŠ›ã«åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ã¯ã€
`{LogManager}` ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ãƒ­ã‚°ã‚’ {Log4j} ã‚„ {Logback} ã®ã‚ˆã†ãªä»–ã®ãƒ­ã‚®ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚`{LogManager}` ã®ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…ã‚’æä¾›ã™ã‚‹ãƒ­ã‚®ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’
ä½¿ã†å ´åˆã¯ã€JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã® `logManager` æ‹¡å¼µãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
æŒ‡å®šã—ãŸ `{LogManager}` å®Ÿè£…ã‚¯ãƒ©ã‚¹ã® _å®Œå…¨ä¿®é£¾å_ ãŒã€`java.util.logging.manager`
ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è¨­å®šã•ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã¯ã€Log4j{nbsp}2.x
ï¼ˆè©³ç´°ã¯ã€{Log4j_JDK_Logging_Adapter} å‚ç…§ï¼‰ã‚’è¨­å®šã™ã‚‹ä¾‹ã§ã™ã€‚

[source,java,indent=0]
[subs=attributes+]
----
junitPlatform {
	logManager 'org.apache.logging.log4j.jul.LogManager'
}
----

ãã®ä»–ã®ãƒ­ã‚®ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã€`java.util.logging` ã®ãƒ­ã‚°ã‚’ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹
æ–¹æ³•ãŒç•°ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã° {Logback} ã§ã¯ã€
https://www.slf4j.org/legacy.html#jul-to-slf4j[JULã‹ã‚‰SLF4Jã¸ã®ãƒ–ãƒªãƒƒã‚¸]
ã‚’å®Ÿè¡Œæ™‚ã®ã‚¯ãƒ©ã‚¹ãƒ‘ã‚¹ã«ä¾å­˜é–¢ä¿‚ã¨ã—ã¦è¿½åŠ ã—ã¦ä½¿ã„ã¾ã™ã€‚

[[running-tests-build-gradle-junit-using]]
===== JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã†

JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’é©ç”¨ã™ã‚‹ã¨ã€`junitPlatformTest` ã‚¿ã‚¹ã‚¯ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ `gradlew junitPlatformTest`ï¼ˆã¾ãŸã¯ã€`gradlew test`ï¼‰
ã‚’å‘¼ã³å‡ºã™ã¨ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­ã§ã‚¯ãƒ©ã‚¹åãŒ `includeClassNamePattern`
ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€`{standard-include-class-name-pattern}`ï¼‰
ã®æ­£è¦è¡¨ç¾ã«ãƒãƒƒãƒã™ã‚‹ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

`{junit5-gradle-consumer}` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ `junitPlatformTest`
ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªå‡ºåŠ›ã«ãªã‚Šã¾ã™ã€‚

....
:junitPlatformTest

Test run finished after 93 ms
[         3 containers found      ]
[         0 containers skipped    ]
[         3 containers started    ]
[         0 containers aborted    ]
[         3 containers successful ]
[         0 containers failed     ]
[         3 tests found           ]
[         1 tests skipped         ]
[         2 tests started         ]
[         0 tests aborted         ]
[         2 tests successful      ]
[         0 tests failed          ]

BUILD SUCCESSFUL
....

ã‚‚ã—ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã¨ã€æ¬¡ã®ã‚ˆã†ãªå‡ºåŠ›ã¨ã¨ã‚‚ã«ãƒ“ãƒ«ãƒ‰ãŒå¤±æ•—ã—ã¾ã™ã€‚

[subs=-callouts]
....
:junitPlatformTest

Test failures (1):
  JUnit Jupiter:SecondTest:mySecondTest()
    MethodSource [className = 'com.example.project.SecondTest', methodName = 'mySecondTest', methodParameterTypes = '']
    => Exception: 2 is not equal to 1 ==> expected: <2> but was: <1>

Test run finished after 99 ms
[         3 containers found      ]
[         0 containers skipped    ]
[         3 containers started    ]
[         0 containers aborted    ]
[         3 containers successful ]
[         0 containers failed     ]
[         3 tests found           ]
[         0 tests skipped         ]
[         3 tests started         ]
[         0 tests aborted         ]
[         2 tests successful      ]
[         1 tests failed          ]

:junitPlatformTest FAILED

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':junitPlatformTest'.
> Process 'command '/Library/Java/JavaVirtualMachines/jdk1.8.0_92.jdk/Contents/Home/bin/java'' finished with non-zero exit value 1
....

NOTE: ã‚³ãƒ³ãƒ†ãƒŠã‚„ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ãŸå ´åˆã€_çµ‚äº†ã‚³ãƒ¼ãƒ‰_ ã¯ `1` ã«ãªã‚Šã¾ã™ã€‚æˆåŠŸã—ãŸå ´åˆã¯ã€`0` ã§ã™ã€‚

.JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç¾åœ¨ã®åˆ¶é™äº‹é …
WARNING: JUnit Gradleãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å®Ÿè¡Œã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã®çµæœã¯ã€
GradleãŒå‡ºåŠ›ã™ã‚‹æ¨™æº–ã®ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã«ã¯å«ã¾ã‚Œã¾ã›ã‚“ã€‚ãŸã ã—ã€
å…¸å‹çš„ãªCIã‚µãƒ¼ãƒãƒ¼ã§ã¯ãƒ†ã‚¹ãƒˆçµæœã¨ã—ã¦åé›†ã§ãã¾ã™ã€‚
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã€`reportsDir` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

[[running-tests-build-maven]]
==== Maven

The JUnit team has developed a very basic provider for Maven Surefire that lets you run
JUnit 4 and JUnit Jupiter tests via `mvn test`. The `pom.xml` file in the
`{junit5-maven-consumer}` project demonstrates how to use it and can serve as a starting
point.

WARNING: Due to a memory leak in Surefire 2.20 and issues running on Java 9,
the `junit-platform-surefire-provider` currently only works with Surefire 2.19.1.

[source,xml,indent=0]
[subs=attributes+]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<dependencies>
					<dependency>
						<groupId>org.junit.platform</groupId>
						<artifactId>junit-platform-surefire-provider</artifactId>
						<version>{platform-version}</version>
					</dependency>
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
----

[[running-tests-build-maven-engines-configure]]
===== Configuring Test Engines

In order to have Maven Surefire run any tests at all, a `TestEngine` implementation must
be added to the runtime classpath.

To configure support for JUnit Jupiter based tests, configure a `test` dependency on the
JUnit Jupiter API, and add the JUnit Jupiter `TestEngine` implementation to the
dependencies of the `maven-surefire-plugin` similar to the following.

[source,xml,indent=0]
[subs=attributes+]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<dependencies>
					<dependency>
						<groupId>org.junit.platform</groupId>
						<artifactId>junit-platform-surefire-provider</artifactId>
						<version>{platform-version}</version>
					</dependency>
					<dependency>
						<groupId>org.junit.jupiter</groupId>
						<artifactId>junit-jupiter-engine</artifactId>
						<version>{jupiter-version}</version>
					</dependency>
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
	<dependencies>
		...
		<dependency>
			<groupId>org.junit.jupiter</groupId>
			<artifactId>junit-jupiter-api</artifactId>
			<version>{jupiter-version}</version>
			<scope>test</scope>
		</dependency>
	</dependencies>
	...
----

The JUnit Platform Surefire Provider can run JUnit 4 based tests as long as you configure
a `test` dependency on JUnit 4 and add the JUnit Vintage `TestEngine` implementation to
the dependencies of the `maven-surefire-plugin` similar to the following.

[source,xml,indent=0]
[subs=attributes+]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<dependencies>
					<dependency>
						<groupId>org.junit.platform</groupId>
						<artifactId>junit-platform-surefire-provider</artifactId>
						<version>{platform-version}</version>
					</dependency>
					...
					<dependency>
						<groupId>org.junit.vintage</groupId>
						<artifactId>junit-vintage-engine</artifactId>
						<version>{vintage-version}</version>
					</dependency>
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
	<dependencies>
		...
		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
			<version>{junit4-version}</version>
			<scope>test</scope>
		</dependency>
	</dependencies>
	...
----

[[running-tests-build-maven-test-system-property]]
===== Running a Single Test Class

The JUnit Platform Surefire Provider supports the `test` JVM system property supported by
the Maven Surefire Plugin. For example, to run only test methods in the
`org.example.MyTest` test class you can execute `mvn -Dtest=org.example.MyTest test` from
the command line. For further details, consult the
https://maven.apache.org/surefire/maven-surefire-plugin/examples/single-test.html[Maven Surefire Plugin]
documentation.

[[running-tests-build-maven-filter-test-class-names]]
===== Filtering by Test Class Names

The Maven Surefire Plugin will scan for test classes whose fully qualified names match
the following patterns.

- `+**/Test*.java+`
- `+**/*Test.java+`
- `+**/*TestCase.java+`

Note, however, that you can override this default behavior by configuring explicit
`include` and `exclude` rules in your `pom.xml` file. See the
https://maven.apache.org/surefire/maven-surefire-plugin/examples/inclusion-exclusion.html[Inclusions and Exclusions of Tests]
documentation for Maven Surefire for details.

[[running-tests-build-maven-filter-tags]]
===== Filtering by Tags

You can filter tests by tags or <<running-tests-tag-expressions, tag expressions>> using
the following configuration properties.

- to include _tags_ or _tag expressions_, use either `groups` or `includeTags`.
- to exclude _tags_ or _tag expressions_, use either `excludedGroups` or `excludeTags`.

[source,xml,indent=0]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<configuration>
			        <properties>
			            <includeTags>acceptance | !feature-a</includeTags>
			            <excludeTags>integration, regression</excludeTags>
			        </properties>
			    </configuration>
				<dependencies>
					...
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
----

[[running-tests-build-maven-config-params]]
===== Configuration Parameters

You can set configuration parameters to influence test discovery and execution by using
the `configurationParameters` property and providing key-value pairs in the Java
`Properties` file syntax.

[source,xml,indent=0]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<configuration>
					<properties>
						<configurationParameters>
							junit.jupiter.conditions.deactivate = *
							junit.jupiter.extensions.autodetection.enabled = true
							junit.jupiter.testinstance.lifecycle.default = per_class
						</configurationParameters>
					</properties>
				</configuration>
				<dependencies>
					...
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
----

[[running-tests-console-launcher]]
=== Console Launcher

The `{ConsoleLauncher}` is a command-line Java application that lets you launch
the JUnit Platform from the console. For example, it can be used to run JUnit
Vintage and JUnit Jupiter tests and print test execution results to the console.

An executable `junit-platform-console-standalone-{platform-version}.jar` with all
dependencies included is published in the central Maven repository under the
https://repo1.maven.org/maven2/org/junit/platform/junit-platform-console-standalone[junit-platform-console-standalone]
directory. You can https://docs.oracle.com/javase/tutorial/deployment/jar/run.html[run] the
standalone `ConsoleLauncher` as shown below.

`java -jar junit-platform-console-standalone-{platform-version}.jar <<<running-tests-console-launcher-options>>>`

Here's an example of its output:

....
â”œâ”€ JUnit Vintage
â”‚  â””â”€ example.JUnit4Tests
â”‚     â””â”€ standardJUnit4Test âœ”
â””â”€ JUnit Jupiter
   â”œâ”€ StandardTests
   â”‚  â”œâ”€ succeedingTest() âœ”
   â”‚  â””â”€ skippedTest() â†· for demonstration purposes
   â””â”€ A special test case
      â”œâ”€ Custom test name containing spaces âœ”
      â”œâ”€ â•¯Â°â–¡Â°ï¼‰â•¯ âœ”
      â””â”€ ğŸ˜± âœ”

Test run finished after 64 ms
[         5 containers found      ]
[         0 containers skipped    ]
[         5 containers started    ]
[         0 containers aborted    ]
[         5 containers successful ]
[         0 containers failed     ]
[         6 tests found           ]
[         1 tests skipped         ]
[         5 tests started         ]
[         0 tests aborted         ]
[         5 tests successful      ]
[         0 tests failed          ]
....

.Exit Code
NOTE: The `{ConsoleLauncher}` exits with a status code of `1` if any containers or tests
failed. Otherwise the exit code is `0`.

[[running-tests-console-launcher-options]]
==== Options

----
include::{consoleLauncherOptionsFile}[]
----


[[running-tests-junit-platform-runner]]
=== Using JUnit 4 to run the JUnit Platform

The `JUnitPlatform` runner is a JUnit 4 based `Runner` which enables you to run any test
whose programming model is supported on the JUnit Platform in a JUnit 4 environment --
for example, a JUnit Jupiter test class.

Annotating a class with `@RunWith(JUnitPlatform.class)` allows it to be run with IDEs and
build systems that support JUnit 4 but do not yet support the JUnit Platform directly.

NOTE: Since the JUnit Platform has features that JUnit 4 does not have, the runner is
only able to support a subset of the JUnit Platform functionality, especially with regard
to reporting (see <<running-tests-junit-platform-runner-technical-names>>). But for the
time being the `JUnitPlatform` runner is an easy way to get started.

[[running-tests-junit-platform-runner-setup]]
==== Setup

You need the following artifacts and their dependencies on the classpath. See
<<dependency-metadata>> for details regarding group IDs, artifact IDs, and versions.

===== Explicit Dependencies

* `junit-platform-runner` in _test_ scope: location of the `JUnitPlatform` runner
* `junit-{junit4-version}.jar` in _test_ scope: to run tests using JUnit 4
* `junit-jupiter-api` in _test_ scope: API for writing tests using JUnit Jupiter, including `@Test`, etc.
* `junit-jupiter-engine` in _test runtime_ scope: implementation of the `TestEngine` API for JUnit Jupiter

===== Transitive Dependencies

* `junit-platform-suite-api` in _test_ scope
* `junit-platform-launcher` in _test_ scope
* `junit-platform-engine` in _test_ scope
* `junit-platform-commons` in _test_ scope
* `opentest4j` in _test_ scope

[[running-tests-junit-platform-runner-technical-names]]
==== Display Names vs. Technical Names

To define a custom _display name_ for the class run via `@RunWith(JUnitPlatform.class)`
simply annotate the class with `@SuiteDisplayName` and provide a custom value.

By default, _display names_ will be used for test artifacts; however, when the
`JUnitPlatform` runner is used to execute tests with a build tool such as Gradle or
Maven, the generated test report often needs to include the _technical names_ of test
artifacts â€” for example, fully qualified class names â€” instead of shorter display names
like the simple name of a test class or a custom display name containing special
characters. To enable technical names for reporting purposes, simply declare the
`@UseTechnicalNames` annotation alongside `@RunWith(JUnitPlatform.class)`.

Note that the presence of `@UseTechnicalNames` overrides any custom display name
configured via `@SuiteDisplayName`.

[[running-tests-junit-platform-runner-single-test]]
==== Single Test Class

One way to use the `JUnitPlatform` runner is to annotate a test class with
`@RunWith(JUnitPlatform.class)` directly. Please note that the test methods in the
following example are annotated with `org.junit.jupiter.api.Test` (JUnit Jupiter), not
`org.junit.Test` (JUnit Vintage). Moreover, in this case the test class must be `public`;
otherwise, some IDEs and build tools might not recognize it as a JUnit 4 test class.

[source,java,indent=0]
----
include::{testDir}/example/JUnit4ClassDemo.java[tags=user_guide]
----

[[running-tests-junit-platform-runner-test-suite]]
==== Test Suite

If you have multiple test classes you can create a test suite as can be seen in the
following example.

[source,java,indent=0]
----
include::{testDir}/example/JUnit4SuiteDemo.java[tags=user_guide]
----

The `JUnit4SuiteDemo` will discover and run all tests in the `example` package
and its subpackages. By default, it will only include test classes whose names match the
pattern `{standard-include-class-name-pattern}`.

.Additional Configuration Options
NOTE: There are more configuration options for discovering and filtering tests than just
`@SelectPackages`. Please consult the
{javadoc-root}/org/junit/platform/suite/api/package-summary.html[Javadoc] for further
details.

[[running-tests-config-params]]
=== Configuration Parameters

In addition to instructing the platform which test classes and test engines to include,
which packages to scan, etc., it is sometimes necessary to provide additional custom
configuration parameters that are specific to a particular test engine. For example, the
JUnit Jupiter `TestEngine` supports _configuration parameters_ for the following use
cases.

- <<writing-tests-test-instance-lifecycle-changing-default>>
- <<extensions-registration-automatic-enabling>>
- <<extensions-conditions-deactivation>>

_Configuration Parameters_ are text-based key-value pairs that can be supplied to test
engines running on the JUnit Platform via one of the following mechanisms.

1. The `configurationParameter()` and `configurationParameters()` methods in the
  `LauncherDiscoveryRequestBuilder` which is used to build a request supplied to the
  <<launcher-api, `Launcher` API>>. When running tests via one of the tools provided
  by the JUnit Platform you can specify configuration parameters as follows:
  * <<running-tests-console-launcher,Console Launcher>>: use the `--config`
    command-line option.
  * <<running-tests-build-gradle-config-params,Gradle plugin>>: use the
    `configurationParameter` or `configurationParameters` DSL.
  * <<running-tests-build-maven-config-params,Maven Surefire provider>>: use the
    `configurationParameters` property.
2. JVM system properties.
3. The JUnit Platform configuration file: a file named `junit-platform.properties` in the
  root of the class path that follows the syntax rules for a Java `Properties` file.

NOTE: Configuration parameters are looked up in the exact order defined above.
Consequently, configuration parameters supplied directly to the `Launcher` take
precedence over those supplied via system properties and the configuration file.
Similarly, configuration parameters supplied via system properties take precedence over
those supplied via the configuration file.

[[running-tests-tag-expressions]]
=== Tag Expressions
Tag expressions are boolean expressions with the operators `!`, `&` and `|`. In addition,
`(` and `)` can be used to adjust for operator precedence.

.Operators (in descending order of precedence)
|===
| Operator | Meaning | Associativity

| `!`      | not     | right
| `&`      | and     | left
| `\|`     | or      | left
|===

If you are tagging your tests across multiple dimensions, tag expressions help you to
select which tests to execute. Tagging by test type (e.g. _micro_, _integration_,
_end-to-end_) and feature (e.g. *foo*, *bar*, *baz*) the following tag expressions can be
useful.

[%header,cols="40,60"]
|===
| Tag Expression
| Selection

| +foo+
| all tests for *foo*

| +bar \| baz+
| all tests for *bar* plus all tests for *baz*

| +bar & baz+
| all tests for the interaction between *bar* and *baz*

| +foo & !end-to-end+
| all tests for *foo*, but not the _end-to-end_ tests

| +(micro \| integration) & (foo \| baz)+
| all _micro_ or _integration_ tests for *foo* or *baz*
|===
