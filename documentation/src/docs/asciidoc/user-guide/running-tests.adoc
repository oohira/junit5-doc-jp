[[running-tests]]
== テストを実行する

[[running-tests-ide]]
=== IDEのサポート

[[running-tests-ide-intellij-idea]]
==== IntelliJ IDEA

IntelliJ IDEAは、バージョン2016.2からJUnit Platform上でのテスト実行をサポートしています。
詳細は、
https://blog.jetbrains.com/idea/2016/08/using-junit-5-in-intellij-idea/[IntelliJ IDEAブログの投稿]
を参照してください。ただし、実際にはIntelliJ IDEA 2017.3またはそれより新しいバージョンの
利用が推奨される点に注意してください。というのも、プロジェクトで利用されるAPIバージョンに応じて
`junit-platform-launcher`, `junit-jupiter-engine`, `junit-vintage-engine`
のJARを自動的にダウンロードしてくれるからです。

WARNING: IntelliJ IDEAのバージョン2017.3より前のリリースは、JUnit 5
の特定のバージョンを同梱している点に注意してください。もしもJUnit Jupiter
の新しいバージョンを使いたい場合、IDE内でのテスト実行はバージョンのコンフリクトで
失敗する可能性があります。そのような場合は、IntelliJ IDEAに同梱されている
JUnit 5より新しいバージョンを使うために、以下の手順に従ってください。

JUnit 5の異なるバージョン (例えば、 {jupiter-version}) を使うには、
`junit-platform-launcher`, `junit-jupiter-engine`, `junit-vintage-engine`
の対応するバージョンのJARをクラスパスに追加する必要があります。

.Gradleの追加の依存関係
[source,groovy]
[subs=attributes+]
----
// Only needed to run tests in a version of IntelliJ IDEA that bundles older versions
testRuntime("org.junit.platform:junit-platform-launcher:{platform-version}")
testRuntime("org.junit.jupiter:junit-jupiter-engine:{jupiter-version}")
testRuntime("org.junit.vintage:junit-vintage-engine:{vintage-version}")
----

.Mavenの追加の依存関係
[source,xml]
[subs=attributes+]
----
<!-- Only needed to run tests in a version of IntelliJ IDEA that bundles older versions -->
<dependency>
	<groupId>org.junit.platform</groupId>
	<artifactId>junit-platform-launcher</artifactId>
	<version>{platform-version}</version>
	<scope>test</scope>
</dependency>
<dependency>
	<groupId>org.junit.jupiter</groupId>
	<artifactId>junit-jupiter-engine</artifactId>
	<version>{jupiter-version}</version>
	<scope>test</scope>
</dependency>
<dependency>
	<groupId>org.junit.vintage</groupId>
	<artifactId>junit-vintage-engine</artifactId>
	<version>{vintage-version}</version>
	<scope>test</scope>
</dependency>
----

[[running-tests-ide-eclipse]]
==== Eclipse

Eclipse IDEは、Oxygen.1a (4.7.1a)リリースからJUnit Platformをサポートしています。

EclipseでJUnit 5を使うための情報は、公式ドキュメント
https://www.eclipse.org/eclipse/news/4.7.1a/#junit-5-support[Eclipse Project Oxygen.1a
(4.7.1a) - New and Noteworthy] の _Eclipse support for JUnit 5_ の節を参照してください。

[[running-tests-ide-other]]
==== その他のIDE

本書執筆時点では、IntelliJ IDEAとEclipse以外のIDEは、JUnit Platform
上でのテスト実行を直接はサポートしていません。しかし、JUnitチームは
あなたが使っているIDEでJUnit 5を試せるように、2つの中間解を提供しています。
<<running-tests-console-launcher>> を手動で使うか、
<<running-tests-junit-platform-runner,JUnit 4ベースのランナー>>
でテストを実行することができます。

[[running-tests-build]]
=== ビルドサポート

[[running-tests-build-gradle]]
==== Gradle

JUnitチームは、`TestEngine` でサポートされるあらゆる種類のテスト（例えば、
JUnit 3、JUnit 4、JUnit Jupiter、 {Specsy} など）を実行できるGradle
プラグインを開発しました。プラグインの使用例は、`{junit5-gradle-consumer}`
プロジェクトの `build.gradle` を参照してください。

[[running-tests-build-gradle-junit-enable]]
===== JUnit Gradleプラグインを有効にする

JUnit Gradleプラグインを使うには、まずGradle 2.5以上であることを
確認してください。その後、`build.gradle` を次のように設定できます。

[source,java,indent=0]
[subs=attributes+]
----
buildscript {
	repositories {
		mavenCentral()
		// The following is only necessary if you want to use SNAPSHOT releases.
		// maven { url 'https://oss.sonatype.org/content/repositories/snapshots' }
	}
	dependencies {
		classpath 'org.junit.platform:junit-platform-gradle-plugin:{platform-version}'
	}
}

apply plugin: 'org.junit.platform.gradle.plugin'
----

[[running-tests-build-gradle-junit-configure]]
===== JUnit Gradleプラグインを設定する

JUnit Gradleプラグインを適用後、次のように設定を変更できます。

[source,java,indent=0]
[subs=attributes+]
----
junitPlatform {
	platformVersion '{platform-version}' // optional, defaults to plugin version
	reportsDir file('build/test-results/junit-platform') // this is the default
	// enableStandardTestTask true
	// selectors (optional)
	// filters (optional)
	// logManager (optional)
}
----

デフォルトでは、JUnit GradleプラグインはGradle標準の `test` タスクを無効化しますが、
`enableStandardTestTask` フラグで変更できます。

[[running-tests-build-gradle-selectors]]
===== セレクタを設定する

デフォルトでは、テストはプロジェクトの出力ディレクトリから探されます。
しかし、`selectors` 拡張要素を使えば、実行するテストを明示的に指定することもできます。

[source,java,indent=0]
----
junitPlatform {
	// ...
	selectors {
		uris 'file:///foo.txt', 'http://example.com/'
		uri 'foo:resource' <1>
		files 'foo.txt', 'bar.csv'
		file 'qux.json' <2>
		directories 'foo/bar', 'bar/qux'
		directory 'qux/bar' <3>
		packages 'com.acme.foo', 'com.acme.bar'
		aPackage 'com.example.app' <4>
		classes 'com.acme.Foo', 'com.acme.Bar'
		aClass 'com.example.app.Application' <5>
		methods 'com.acme.Foo#a', 'com.acme.Foo#b'
		method 'com.example.app.Application#run(java.lang.String[])' <6>
		resources '/bar.csv', '/foo/input.json'
		resource '/com/acme/my.properties' <7>
		modules 'foo', 'bar'
		module 'baz' <8>
	}
	// ...
}
----
<1> URI（訳注：URIからどうテストを解決するかは個々のテストエンジンに依存しており、JUnit Platformが関知するところではない）
<2> ローカルファイル
<3> ローカルディレクトリ
<4> パッケージ
<5> クラスの完全修飾名
<6> メソッドの完全修飾名 ({DiscoverySelectors_selectMethod} を参照)
<7> クラスパスリソース
<8> モジュール名

[[running-tests-build-gradle-filters]]
===== フィルタを設定する

`filters` 拡張を使うことで、テストプランのフィルタを設定できます。デフォルトでは、
すべてのエンジンとタグがテストプランに含まれ、`includeClassNamePattern`
(`{standard-include-class-name-pattern}`) だけが適用されます。
次の例で示すように、デフォルトパターンは変更することができます。
複数のパターンを指定した場合は、OR (論理和) で結合されます。

[source,java,indent=0]
----
junitPlatform {
	// ...
	filters {
		engines {
			include 'junit-jupiter'
			// exclude 'junit-vintage'
		}
		tags {
			include 'fast', 'smoke & feature-a'
			// exclude 'slow', 'ci'
		}
		packages {
			include 'com.sample.included1', 'com.sample.included2'
			// exclude 'com.sample.excluded1', 'com.sample.excluded2'
		}
		includeClassNamePattern '.*Spec'
		includeClassNamePatterns '.*Test', '.*Tests'
	}
	// ...
}
----

`engines {include ...}` または `engines {exclude ...}` で _テストエンジンID_
を指定すると、JUnit Gradleプラグインはそのテストエンジンのテストだけを実行します。
同様に、`tags {include ...}` または `tags {exclude ...}` で _タグ_ や
<<running-tests-tag-expressions, _タグ式_>> を指定すると、JUnit Gradle
プラグインは（例えば、JUnit Jupiterベースのテストの場合は `@Tag` アノテーションで）
タグ付けされたテストだけを実行します。
`packages {include ...}` または `packages {exclude ...}` を使って、
パッケージ名についても同様のことができます。

[[running-tests-build-gradle-config-params]]
===== 設定パラメーター

`configurationParameter` または `configurationParameters` DSL を使って、
テストを発見・実行するための設定パラメーターを指定できます。前者は、
単一の設定パラメーターを指定するのに使えます。後者は、
一度に複数のキー・値のペアを指定するために、設定パラメーターのマップを受け取ります。
すべてのキーと値は、`String` でなければなりません。

[source,java,indent=0]
----
junitPlatform {
	// ...
	configurationParameter 'junit.jupiter.conditions.deactivate', '*'
	configurationParameters([
		'junit.jupiter.extensions.autodetection.enabled': 'true',
		'junit.jupiter.testinstance.lifecycle.default': 'per_class'
	])
	// ...
}
----

[[running-tests-build-gradle-engines-configure]]
===== テストエンジンを設定する

JUnit Gradleプラグインにテストを実行させるためには、`TestEngine`
の実装がクラスパスに存在しなければなりません。

JUnit Jupiterベースのテストをサポートするためには、JUnit Jupiter API
に対する `testCompile` 依存と、JUnit Jupiter `TestEngine`
実装に対する `testRuntime` 依存を次のように指定する必要があります。

[source,java,indent=0]
[subs=attributes+]
----
dependencies {
	testCompile("org.junit.jupiter:junit-jupiter-api:{jupiter-version}")
	testRuntime("org.junit.jupiter:junit-jupiter-engine:{jupiter-version}")
}
----

JUnit Gradleプラグインは、JUnit 4ベースのテストも実行することができます。
そのためには、JUnit 4に対する `testCompile` 依存と、JUnit Vintage
`TestEngine` 実装に対する `testRuntime` 依存が必要です。

[source,java,indent=0]
[subs=attributes+]
----
dependencies {
	testCompile("junit:junit:{junit4-version}")
	testRuntime("org.junit.vintage:junit-vintage-engine:{vintage-version}")
}
----

[[running-tests-build-gradle-logging]]
===== ロギングを設定する（省略可）

JUnitは、`java.util.logging` パッケージ（別名、_JUL_）の Java Logging API
を警告やデバッグ情報の出力に利用しています。設定オプションについては、
`{LogManager}` の公式ドキュメントを参照してください。

ログを {Log4j} や {Logback} のような他のロギングフレームワークにリダイレクトする
ことも可能です。`{LogManager}` のカスタム実装を提供するロギングフレームワークを
使う場合は、JUnit Gradleプラグインの `logManager` 拡張プロパティを設定してください。
指定した `{LogManager}` 実装クラスの _完全修飾名_ が、`java.util.logging.manager`
システムプロパティに設定されます。以下は、Log4j{nbsp}2.x
（詳細は、{Log4j_JDK_Logging_Adapter} 参照）を設定する例です。

[source,java,indent=0]
[subs=attributes+]
----
junitPlatform {
	logManager 'org.apache.logging.log4j.jul.LogManager'
}
----

その他のロギングフレームワークは、`java.util.logging` のログをリダイレクトする
方法が異なります。例えば {Logback} では、
https://www.slf4j.org/legacy.html#jul-to-slf4j[JULからSLF4Jへのブリッジ]
を実行時のクラスパスに依存関係として追加して使います。

[[running-tests-build-gradle-junit-using]]
===== JUnit Gradleプラグインを使う

JUnit Gradleプラグインを適用すると、`junitPlatformTest` タスクが使えるようになります。

コマンドラインで `gradlew junitPlatformTest`（または、`gradlew test`）
を呼び出すと、プロジェクトの中でクラス名が `includeClassNamePattern`
（デフォルトでは、`{standard-include-class-name-pattern}`）
の正規表現にマッチするすべてのテストが実行されます。

`{junit5-gradle-consumer}` プロジェクトで `junitPlatformTest`
タスクを実行すると、次のような出力になります。

....
:junitPlatformTest

Test run finished after 93 ms
[         3 containers found      ]
[         0 containers skipped    ]
[         3 containers started    ]
[         0 containers aborted    ]
[         3 containers successful ]
[         0 containers failed     ]
[         3 tests found           ]
[         1 tests skipped         ]
[         2 tests started         ]
[         0 tests aborted         ]
[         2 tests successful      ]
[         0 tests failed          ]

BUILD SUCCESSFUL
....

もしテストが失敗すると、次のような出力とともにビルドが失敗します。

[subs=-callouts]
....
:junitPlatformTest

Test failures (1):
  JUnit Jupiter:SecondTest:mySecondTest()
    MethodSource [className = 'com.example.project.SecondTest', methodName = 'mySecondTest', methodParameterTypes = '']
    => Exception: 2 is not equal to 1 ==> expected: <2> but was: <1>

Test run finished after 99 ms
[         3 containers found      ]
[         0 containers skipped    ]
[         3 containers started    ]
[         0 containers aborted    ]
[         3 containers successful ]
[         0 containers failed     ]
[         3 tests found           ]
[         0 tests skipped         ]
[         3 tests started         ]
[         0 tests aborted         ]
[         2 tests successful      ]
[         1 tests failed          ]

:junitPlatformTest FAILED

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':junitPlatformTest'.
> Process 'command '/Library/Java/JavaVirtualMachines/jdk1.8.0_92.jdk/Contents/Home/bin/java'' finished with non-zero exit value 1
....

NOTE: コンテナやテストが失敗した場合、_終了コード_ は `1` になります。成功した場合は、`0` です。

.JUnit Gradleプラグインの現在の制限事項
WARNING: JUnit Gradleプラグインに実行されたテストの結果は、
Gradleが出力する標準のテストレポートには含まれません。ただし、
典型的なCIサーバーではテスト結果として収集できます。
プラグインの、`reportsDir` プロパティを参照してください。

[[running-tests-build-maven]]
==== Maven

JUnitチームは、`mvn test` でJUnit 4とJUnit Jupiterのテストを実行できる
Maven Surefireプロバイダを開発しました。 `{junit5-maven-consumer}`
プロジェクトの `pom.xml` ファイルが使い方を示しています。

WARNING: Surefire 2.20のメモリリークとJava 9実行時の問題のため、
`junit-platform-surefire-provider` は現在Surefire 2.19.1のみで動作します。

[source,xml,indent=0]
[subs=attributes+]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<dependencies>
					<dependency>
						<groupId>org.junit.platform</groupId>
						<artifactId>junit-platform-surefire-provider</artifactId>
						<version>{platform-version}</version>
					</dependency>
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
----

[[running-tests-build-maven-engines-configure]]
===== テストエンジンを設定する

Maven Surefireにテストを実行させるためには、`TestEngine` の実装が
実行時のクラスパスに必要です。

JUnit Jupiterベースのテストをサポートするためには、JUnit Jupiter API
に対する `test` 依存と、JUnit Jupiter `TestEngine` 実装に対する
`maven-surefire-plugin` の依存を次のように指定する必要があります。

[source,xml,indent=0]
[subs=attributes+]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<dependencies>
					<dependency>
						<groupId>org.junit.platform</groupId>
						<artifactId>junit-platform-surefire-provider</artifactId>
						<version>{platform-version}</version>
					</dependency>
					<dependency>
						<groupId>org.junit.jupiter</groupId>
						<artifactId>junit-jupiter-engine</artifactId>
						<version>{jupiter-version}</version>
					</dependency>
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
	<dependencies>
		...
		<dependency>
			<groupId>org.junit.jupiter</groupId>
			<artifactId>junit-jupiter-api</artifactId>
			<version>{jupiter-version}</version>
			<scope>test</scope>
		</dependency>
	</dependencies>
	...
----

JUnit Platform Surefireプロバイダは、JUnit 4ベースのテストも実行することができます。
そのためには、JUnit 4に対する `test` 依存と、JUnit Vintage `TestEngine` 実装に対する
`maven-surefire-plugin` の依存が必要です。

[source,xml,indent=0]
[subs=attributes+]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<dependencies>
					<dependency>
						<groupId>org.junit.platform</groupId>
						<artifactId>junit-platform-surefire-provider</artifactId>
						<version>{platform-version}</version>
					</dependency>
					...
					<dependency>
						<groupId>org.junit.vintage</groupId>
						<artifactId>junit-vintage-engine</artifactId>
						<version>{vintage-version}</version>
					</dependency>
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
	<dependencies>
		...
		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
			<version>{junit4-version}</version>
			<scope>test</scope>
		</dependency>
	</dependencies>
	...
----

[[running-tests-build-maven-test-system-property]]
===== 単一のテストクラスを実行する

JUnit Platform Surefireプロバイダは、Maven Surefireプラグインがサポートする
JVMシステムプロパティ `test` に対応しています。例えば、コマンドラインから
`mvn -Dtest=org.example.MyTest test` を実行することで、テストクラス
`org.example.MyTest` のテストメソッドだけを実行できます。詳細は、
https://maven.apache.org/surefire/maven-surefire-plugin/examples/single-test.html[Maven Surefireプラグイン]
のドキュメントを参照してください。

[[running-tests-build-maven-filter-test-class-names]]
===== テストクラス名でフィルタリングする

Maven Surefireプラグインは、完全修飾名が次のパターンにマッチするテストクラスを探します。

- `+**/Test*.java+`
- `+**/*Test.java+`
- `+**/*TestCase.java+`

ただし、`pom.xml` ファイルの `include` および `exclude`
ルールを明示的に設定することで、デフォルトの動作を変更することもできます。
詳細は、 Maven Surefireのドキュメント
https://maven.apache.org/surefire/maven-surefire-plugin/examples/inclusion-exclusion.html[Inclusions and Exclusions of Tests]
を参照してください。

[[running-tests-build-maven-filter-tags]]
===== タグでフィルタリングする

次のように、タグまたは <<running-tests-tag-expressions, タグ式>>
を使ってテストをフィルタリングすることもできます。

- _タグ_ または _タグ式_ をテスト対象に含めるには、`groups` または `includeTags` を指定します。
- _タグ_ または _タグ式_ をテスト対象から除外するには、`excludedGroups` または `excludeTags` を指定します。

[source,xml,indent=0]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<configuration>
			        <properties>
			            <includeTags>acceptance | !feature-a</includeTags>
			            <excludeTags>integration, regression</excludeTags>
			        </properties>
			    </configuration>
				<dependencies>
					...
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
----

[[running-tests-build-maven-config-params]]
===== 設定パラメーター

`configurationParameters` プロパティにJavaの `Properties` ファイル形式の
キー・値のペアを与えることで、テストを発見・実行するための設定パラメーターを指定できます。

[source,xml,indent=0]
----
	...
	<build>
		<plugins>
			...
			<plugin>
				<artifactId>maven-surefire-plugin</artifactId>
				<version>2.19.1</version>
				<configuration>
					<properties>
						<configurationParameters>
							junit.jupiter.conditions.deactivate = *
							junit.jupiter.extensions.autodetection.enabled = true
							junit.jupiter.testinstance.lifecycle.default = per_class
						</configurationParameters>
					</properties>
				</configuration>
				<dependencies>
					...
				</dependencies>
			</plugin>
		</plugins>
	</build>
	...
----

[[running-tests-console-launcher]]
=== Console Launcher

`{ConsoleLauncher}` は、コンソールからJUnit Platformを起動するための
Javaのコマンドラインアプリケーションです。例えば、JUnit VintageとJUnit Jupiter
のテストを実行し、結果をコンソールに表示するのに使えます。

すべての依存関係を含んだ実行可能な `junit-platform-console-standalone-{platform-version}.jar`
がMavenセントラルリポジトリの
https://repo1.maven.org/maven2/org/junit/platform/junit-platform-console-standalone[junit-platform-console-standalone]
ディレクトリで公開されています。スタンドアロン版の `ConsoleLauncher` は、次のように
https://docs.oracle.com/javase/tutorial/deployment/jar/run.html[実行する] ことができます。

`java -jar junit-platform-console-standalone-{platform-version}.jar <<<running-tests-console-launcher-options>>>`

出力の例は次の通りです。

....
├─ JUnit Vintage
│  └─ example.JUnit4Tests
│     └─ standardJUnit4Test ✔
└─ JUnit Jupiter
   ├─ StandardTests
   │  ├─ succeedingTest() ✔
   │  └─ skippedTest() ↷ for demonstration purposes
   └─ A special test case
      ├─ Custom test name containing spaces ✔
      ├─ ╯°□°）╯ ✔
      └─ 😱 ✔

Test run finished after 64 ms
[         5 containers found      ]
[         0 containers skipped    ]
[         5 containers started    ]
[         0 containers aborted    ]
[         5 containers successful ]
[         0 containers failed     ]
[         6 tests found           ]
[         1 tests skipped         ]
[         5 tests started         ]
[         0 tests aborted         ]
[         5 tests successful      ]
[         0 tests failed          ]
....

.終了コード
NOTE: `{ConsoleLauncher}` は、コンテナやテストが失敗するとステータスコード
`1` で終了します。成功した場合は、`0` です。

[[running-tests-console-launcher-options]]
==== オプション

----
include::{consoleLauncherOptionsFile}[]
----


[[running-tests-junit-platform-runner]]
=== JUnit Platformの実行にJUnit 4を使う

`JUnitPlatform` ランナーは、JUnit Platformのプログラミングモデルに従ったテスト
（例えば、JUnit Jupiterのテストクラス）をJUnit 4環境で実行可能にするための
JUnit 4ベースの `Runner` です。

テストクラスに `@RunWith(JUnitPlatform.class)` アノテーションを付与すると、
まだJUnit Platformを直接はサポートしていないけれどもJUnit 4ならサポートしている
IDEやビルドシステムでも実行できるようになります。

NOTE: JUnit PlatformはJUnit 4にない機能をもっているため、特にレポート周り
(<<running-tests-junit-platform-runner-technical-names>> を参照)など、
JUnit Platformの機能のサブセットしかサポートすることができません。
しかし、さしあたっては `JUnitPlatform` ランナーを使って始めるのが簡単です。

[[running-tests-junit-platform-runner-setup]]
==== セットアップ

クラスパスに以下のライブラリとその依存ライブラリが必要です。Group IDやArtifact ID、
バージョンの詳細については、 <<dependency-metadata>> を参照してください。

===== 明示的な依存関係

* `junit-platform-runner` は _test_ スコープ: `JUnitPlatform` ランナーが含まれる
* `junit-{junit4-version}.jar` は _test_ スコープ: JUnit 4を使ってテストを実行するため
* `junit-jupiter-api` は _test_ スコープ: `@Test` などJUnit Jupiterを使ってテストを書くためのAPI
* `junit-jupiter-engine` は _test runtime_ スコープ: JUnit Jupiterのための `TestEngine` API実装

===== 推移的な依存関係

* `junit-platform-suite-api` は _test_ スコープ
* `junit-platform-launcher` は _test_ スコープ
* `junit-platform-engine` は _test_ スコープ
* `junit-platform-commons` は _test_ スコープ
* `opentest4j` は _test_ スコープ

[[running-tests-junit-platform-runner-technical-names]]
==== 表示名 vs. 技術名

[TIP]
====
訳注：本文書では _Display Name_ に対して _表示名_ という訳語を使用し、
本節で登場する _Technical Name_ に対しては _技術名_ という訳語を使用した。
しかし、後者は直感的ではないと思うので、適切な訳があればフィードバックをいただきたい。
====

`@RunWith(JUnitPlatform.class)` ランナーで実行されるクラスにカスタムの
_表示名 (display name)_ を定義するためには、`@SuiteDisplayName`
アノテーションを付与します。

デフォルトでは、 _表示名_ はテストの成果物に使われます。しかし、Gradleや
Mavenのようなビルドツールが `JUnitPlatform` ランナーを使う場合、
生成されるテストレポートには、テストクラスの単純名や
特殊文字を含むカスタム表示名ではなく、完全修飾クラス名のような
_技術名 (technical name)_ が必要になることがあります。
レポート出力で _技術名_ を有効にするためには、
`@RunWith(JUnitPlatform.class)` と一緒に `@UseTechnicalNames`
アノテーションを宣言してください。

`@UseTechnicalNames` を付与すると、`@SuiteDisplayName`
でしたカスタム表示名は無視される点に注意してください。

[[running-tests-junit-platform-runner-single-test]]
==== 単一のテストクラス

`JUnitPlatform` ランナーを使う方法の1つは、テストクラスに直接
`@RunWith(JUnitPlatform.class)` アノテーションを付与することです。
以下の例のテストメソッドには、`org.junit.Test` (JUnit Vintage) ではなく、
`org.junit.jupiter.api.Test` (JUnit Jupiter)
アノテーションが付与されている点に注意してください。さらに、
この場合はテストクラスを `public` にしなければならない点にも注意してください。
そうしないと、一部のIDEやビルドツールではJUnit 4のテストクラスとして
認識されません。

[source,java,indent=0]
----
include::{testDir}/example/JUnit4ClassDemo.java[tags=user_guide]
----

[[running-tests-junit-platform-runner-test-suite]]
==== テストスイート

複数のテストクラスがある場合、次の例のようにテストスイートを作成できます。

[source,java,indent=0]
----
include::{testDir}/example/JUnit4SuiteDemo.java[tags=user_guide]
----

`JUnit4SuiteDemo` は、`example` パッケージとそのサブパッケージから
すべてのテストを探して実行します。デフォルトでは、名前が
`{standard-include-class-name-pattern}` のパターンにマッチする
テストクラスだけを実行します。

.追加の設定オプション
NOTE: `@SelectPackages` 以外にも、テストを検索したりフィルタリングしたりするための
設定オプションがあります。詳細は、
{javadoc-root}/org/junit/platform/suite/api/package-summary.html[Javadoc]
を参照してください。

[[running-tests-config-params]]
=== 設定パラメーター

どのテストクラスやテストエンジンを含むか、どのパッケージを検索するか、といったことを
プラットフォームに指示するだけでなく、特定のテストエンジンに固有の追加の設定パラメーター
を渡したい場合もあります。例えば、JUnit Jupiterの `TestEngine` は、
次のユースケースのために _設定パラメーター_ をサポートしています。

- <<writing-tests-test-instance-lifecycle-changing-default>>
- <<extensions-registration-automatic-enabling>>
- <<extensions-conditions-deactivation>>

_設定パラメーター_ は、テキストベースのキーと値のペアで、JUnit Platform
で動作するテストエンジンに次のいずれかの方法で渡されます。

1. `LauncherDiscoveryRequestBuilder` クラスの `configurationParameter()`
  または `configurationParameters()` メソッドを使って構築したリクエストを
  <<launcher-api, `Launcher` API>> に渡します。JUnit Platform
  が提供するツールを使ってテストを実行する場合、設定パラメーターは次のように指定できます。
  * <<running-tests-console-launcher,Console Launcher>>: `--config`
    コマンドラインオプションを使います
  * <<running-tests-build-gradle-config-params,Gradleプラグイン>>:
    `configurationParameter` または `configurationParameters` DSLを使います
  * <<running-tests-build-maven-config-params,Maven Surefireプロバイダ>>:
    `configurationParameters` プロパティを使います
2. JVMシステムプロパティ
3. JUnit Platform設定ファイル: クラスパスのルートに `junit-platform.properties`
  という名前で配置され、Javaの `Properties` ファイルと同じシンタックスに従います。

NOTE: 設定パラメーターは、上で定義された順番に従って解決されます。つまり、
`Launcher` に直接与えられた設定パラメーターの方が、システムプロパティや設定ファイルで
与えられたものより優先されます。同様に、システムプロパティで与えられた設定パラメーターの方が、
設定ファイルで与えられたものより優先されます。

[[running-tests-tag-expressions]]
=== タグ式
タグ式は、 `!`, `&`, `|` 演算子からなるブール式です。
演算子の優先順位を調整するために、`(` と `)` も使えます。

.演算子 (優先順位の降順)
|===
| 演算子    | 意味    | 結合性

| `!`      | not     | right
| `&`      | and     | left
| `\|`     | or      | left
|===

テストに直交するタグを付与している場合、実行するテストを選択するのにタグ式は便利です。
テストの種類 (例えば、_micro_, _integration_, _end-to-end_) と機能
(例えば、 *foo*, *bar*, *baz*) のタグを付与すると、次のようなタグ式が使えます。

[%header,cols="40,60"]
|===
| タグ式
| 該当するテスト

| +foo+
| *foo* に対するすべてのテスト

| +bar \| baz+
| *bar* または *baz* に対するすべてのテスト

| +bar & baz+
| *bar* かつ *baz* に対するすべてのテスト

| +foo & !end-to-end+
| *foo*　に対するテストのうち、_end-to-end_ レベル以外のすべてのテスト

| +(micro \| integration) & (foo \| baz)+
| *foo* または *baz* に対するテストのうち、_micro_ または _integration_ レベルのすべてのテスト
|===
